# Tie Drop Game - Backend & Deployment Guide

## 1. Environment Variables (API Keys)

Whether you are running the game locally or deploying it to a server (like Render), you need to configure your API keys.

### **A. Local Development**
Create a file named `.env` in the root folder of your project and paste the following. Replace the values with your actual keys.

```env
# Server Port
PORT=3000

# Session Security (Make up a long random string)
SESSION_SECRET=change_this_to_something_random_and_secure

# Twitter / X Authentication
# Get these from the X Developer Portal: https://developer.twitter.com/en/portal/dashboard
TWITTER_CONSUMER_KEY=your_twitter_api_key
TWITTER_CONSUMER_SECRET=your_twitter_api_secret
# For local testing:
CALLBACK_URL=http://localhost:3000/auth/twitter/callback

# Supabase Database (Leaderboard & Chat)
# Get these from your Supabase Project Settings -> API
SUPABASE_URL=https://your-project-id.supabase.co
SUPABASE_KEY=your_public_anon_key
```

### **B. Production Deployment (e.g., Render.com)**
When deploying, **do not** upload your `.env` file. Instead, go to your hosting dashboard:
1.  Go to **Settings** or **Environment**.
2.  Find the **Environment Variables** section.
3.  Add each key-value pair manually:
    *   `TWITTER_CONSUMER_KEY`: ...
    *   `TWITTER_CONSUMER_SECRET`: ...
    *   `CALLBACK_URL`: `https://your-app-name.onrender.com/auth/twitter/callback` (Update this!)
    *   `SESSION_SECRET`: ...
    *   `SUPABASE_URL`: ...
    *   `SUPABASE_KEY`: ...

---

## 2. Supabase Setup (SQL)

To make the leaderboard and chat work, run this SQL in your Supabase **SQL Editor**:

```sql
-- 1. Create Users Table
create table users (
  twitter_id text primary key,
  username text,
  display_name text,
  photo_url text,
  profile_url text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 2. Create Scores Table
create table scores (
  id bigint generated by default as identity primary key,
  twitter_id text references users(twitter_id) not null,
  score integer not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 3. Create Messages Table
create table messages (
  id bigint generated by default as identity primary key,
  user_name text not null,
  text text not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);
```

## 3. Deployment Steps (Render.com)

1.  Push this code to **GitHub**.
2.  Create a new **Web Service** on Render.
3.  Connect your repository.
4.  **Build Command**: `npm install`
5.  **Start Command**: `node server_supabase.js`
6.  Add your **Environment Variables** (from Section 1B).
7.  **Important**: Go back to X Developer Portal and update your **Callback URL** to match your new Render URL.
